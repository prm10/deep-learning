clc;clear all;close all;
load im_data.mat;
x=batchdata;
% x=generate_batches(data_train1,100);
% y=generate_batches(data_validation1,100);
% num=[1000 500 250 30];
% [vishid,hidbiases,visbiases]=dbm_initial(x,num);
[batchposhidprobs,vishid,hidbiases,visbiases]=rbm_model(x,1000);
a1=batchdata(1,:,1);
z2=a1*vishid+hidrecbiases;
a2=1./(1+exp(-z2));
z3=a2*vishid'+visbiases;
a3=1./(1+exp(-z3));
figure;
imshow([reshape(a1,[28 28])' reshape(a3,[28 28])']);
% Weight=dbm_BP(x,y,num,vishid,hidbiases,visbiases);
% % 重构
% [data_train2,data_train2_error]=dbm_reconstruction(data_train1,Weight);
% [data_validation2,data_validation2_error]=dbm_reconstruction(data_validation1,Weight);
% [data_test2,data_test2_error]=dbm_reconstruction(data_test1,Weight);
% % figure,plot(z_error);
% data_train3=iguiyihua(data_train2,M_train,S_train);%训练集
% data_validation3=iguiyihua(data_validation2,M_train,S_train);%验证集
% data_test3=iguiyihua(data_test2,M_train,S_train);%测试集
% 
% data_show0=[data_train0;data_validation0];
% data_show1=[data_train1;data_validation1];
% data_show2=[data_train2;data_validation2];
% data_show3=[data_train3;data_validation3];
% for i1=1:size(data_show0,2)
%     figure,plot(1:length(data_show1),data_show1(:,i1),1:length(data_show2),data_show2(:,i1));
%     title(name_str{i1});
%     legend('原始信号','重构信号');
% end